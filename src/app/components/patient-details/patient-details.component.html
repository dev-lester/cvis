<div class="patient-details-container">
  @if (showWhenToggle) {
  <div class="form-header">
    <div class="logo"><img src="logo1.png" alt="" /></div>
    <div class="contacts">
      <div>+123-456-7890</div>
      <div>hello&#64;cardiorad.com</div>
      <div>www.cardioradx.com</div>
    </div>
  </div>
  }
  <div class="header">
    <h1>{{ getTitle() }}</h1>
    <div class="header-actions">
      <button
        *ngIf="mode === 'view'"
        (click)="switchToEdit()"
        class="btn-secondary"
      >
        ‚úèÔ∏è Edit
      </button>
      <button
        *ngIf="mode === 'edit'"
        (click)="switchToView()"
        class="btn-secondary"
      >
        üëÅÔ∏è View
      </button>
      <button (click)="goBack()" class="btn-secondary">‚Üê Back to List</button>
    </div>
  </div>

  <div class="patient-form-container">
    <form [formGroup]="patientForm" (ngSubmit)="onSubmit()">
      <div class="form-section">
        <h3>Exam</h3>
        <div class="image-upload-section">
          <div class="current-image" *ngIf="currentImagePreview">
            <img
              [src]="currentImagePreview"
              alt="Profile Preview"
              class="image-preview"
            />
            <button
              type="button"
              (click)="removeImage()"
              class="btn-remove-image"
              *ngIf="mode !== 'view'"
            >
              √ó
            </button>
          </div>

          <div class="upload-area" *ngIf="mode !== 'view'">
            <input
              type="file"
              #fileInput
              (change)="onFileSelected($event)"
              accept="image/*"
              style="display: none"
            />
            <button
              type="button"
              (click)="fileInput.click()"
              class="btn-upload"
            >
              üìÅ Choose Image
            </button>
            <p class="upload-hint">
              Supported formats: JPG, PNG, GIF (Max: 2MB)
            </p>
          </div>
        </div>
      </div>
      <div class="form-section">
        <h3>Personal Information</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="firstName">First Name *</label>
            <input
              type="text"
              id="firstName"
              formControlName="firstName"
              class="form-control"
              [readonly]="mode === 'view'"
              [class.error]="
                patientForm.get('firstName')?.invalid &&
                patientForm.get('firstName')?.touched
              "
            />
            <div
              *ngIf="
                patientForm.get('firstName')?.invalid &&
                patientForm.get('firstName')?.touched
              "
              class="error-message"
            >
              First name is required
            </div>
          </div>

          <div class="form-group">
            <label for="lastName">Last Name *</label>
            <input
              type="text"
              id="lastName"
              formControlName="lastName"
              class="form-control"
              [readonly]="mode === 'view'"
              [class.error]="
                patientForm.get('lastName')?.invalid &&
                patientForm.get('lastName')?.touched
              "
            />
            <div
              *ngIf="
                patientForm.get('lastName')?.invalid &&
                patientForm.get('lastName')?.touched
              "
              class="error-message"
            >
              Last name is required
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="dateOfBirth">Date of Birth *</label>
            <input
              type="date"
              id="dateOfBirth"
              formControlName="dateOfBirth"
              class="form-control"
              [readonly]="mode === 'view'"
              [class.error]="
                patientForm.get('dateOfBirth')?.invalid &&
                patientForm.get('dateOfBirth')?.touched
              "
            />
            <div
              *ngIf="
                patientForm.get('dateOfBirth')?.invalid &&
                patientForm.get('dateOfBirth')?.touched
              "
              class="error-message"
            >
              Date of birth is required
            </div>
          </div>

          <div class="form-group">
            <label for="gender">Gender *</label>
            <select
              id="gender"
              formControlName="gender"
              class="form-control"
              [class.error]="
                patientForm.get('gender')?.invalid &&
                patientForm.get('gender')?.touched
              "
            >
              <option value="">Select Gender</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Other">Other</option>
            </select>
            <div
              *ngIf="
                patientForm.get('gender')?.invalid &&
                patientForm.get('gender')?.touched
              "
              class="error-message"
            >
              Gender is required
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="studyDate">Study Date</label>
            <input
              type="date"
              id="studyDate"
              formControlName="studyDate"
              class="form-control"
              [readonly]="mode === 'view'"
              [class.error]="
                patientForm.get('studyDate')?.invalid &&
                patientForm.get('studyDate')?.touched
              "
            />
            <div
              *ngIf="
                patientForm.get('studyDate')?.invalid &&
                patientForm.get('studyDate')?.touched
              "
              class="error-message"
            >
              Study Date is required
            </div>
          </div>

          <div class="form-group">
            <label for="bloodPressure">Blood Pressure</label>
            <input
              type="text"
              id="bloodPressure"
              formControlName="bloodPressure"
              class="form-control"
              [readonly]="mode === 'view'"
              [class.error]="
                patientForm.get('bloodPressure')?.invalid &&
                patientForm.get('bloodPressure')?.touched
              "
            />
            <div
              *ngIf="
                patientForm.get('bloodPressure')?.invalid &&
                patientForm.get('bloodPressure')?.touched
              "
              class="error-message"
            >
              Blood Pressure is required
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="rhythm">Rhythm</label>
            <input
              type="text"
              id="rhythm"
              formControlName="rhythm"
              class="form-control"
              [readonly]="mode === 'view'"
              [class.error]="
                patientForm.get('rhythm')?.invalid &&
                patientForm.get('rhythm')?.touched
              "
            />
            <div
              *ngIf="
                patientForm.get('rhythm')?.invalid &&
                patientForm.get('rhythm')?.touched
              "
              class="error-message"
            >
              Rhythm is required
            </div>
          </div>

          <div class="form-group">
            <label for="heartRate">Hear Rate</label>
            <input
              type="text"
              id="heartRate"
              formControlName="heartRate"
              class="form-control"
              [readonly]="mode === 'view'"
              [class.error]="
                patientForm.get('heartRate')?.invalid &&
                patientForm.get('heartRate')?.touched
              "
            />
            <div
              *ngIf="
                patientForm.get('heartRate')?.invalid &&
                patientForm.get('heartRate')?.touched
              "
              class="error-message"
            >
              Heart Rate
            </div>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3>Procedure Staff</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="ultrasoundTechnologist">Ultrasound Technologist</label>
            <input
              type="text"
              id="ultrasoundTechnologist"
              formControlName="ultrasoundTechnologist"
              class="form-control"
              [readonly]="mode === 'view'"
              [class.error]="
                patientForm.get('ultrasoundTechnologist')?.invalid &&
                patientForm.get('ultrasoundTechnologist')?.touched
              "
            />
            <div
              *ngIf="
                patientForm.get('ultrasoundTechnologist')?.invalid &&
                patientForm.get('ultrasoundTechnologist')?.touched
              "
              class="error-message"
            >
              Ultrasound Technologist is required
            </div>
          </div>

          <div class="form-group">
            <label for="orderingPhysician">Ordering Physician</label>
            <input
              type="text"
              id="orderingPhysician"
              formControlName="orderingPhysician"
              class="form-control"
              [readonly]="mode === 'view'"
              [class.error]="
                patientForm.get('orderingPhysician')?.invalid &&
                patientForm.get('orderingPhysician')?.touched
              "
            />
            <div
              *ngIf="
                patientForm.get('orderingPhysician')?.invalid &&
                patientForm.get('orderingPhysician')?.touched
              "
              class="error-message"
            >
              Ordering Physician is required
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="indication">Indication</label>
          <textarea
            id="indication"
            formControlName="indication"
            class="form-control"
            rows="3"
            [readonly]="mode === 'view'"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="findings">Findings</label>
          <textarea
            id="findings"
            formControlName="findings"
            class="form-control"
            rows="3"
            [readonly]="mode === 'view'"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="conclusions">Conclusions</label>
          <textarea
            id="conclusions"
            formControlName="conclusions"
            class="form-control"
            rows="3"
            [readonly]="mode === 'view'"
          ></textarea>
        </div>
      </div>

      <div class="form-section">
        <h3>Contact Information</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="phone">Phone *</label>
            <input
              type="tel"
              id="phone"
              formControlName="phone"
              class="form-control"
              [readonly]="mode === 'view'"
              [class.error]="
                patientForm.get('phone')?.invalid &&
                patientForm.get('phone')?.touched
              "
            />
            <div
              *ngIf="
                patientForm.get('phone')?.invalid &&
                patientForm.get('phone')?.touched
              "
              class="error-message"
            >
              Phone is required
            </div>
          </div>

          <div class="form-group">
            <label for="email">Email *</label>
            <input
              type="email"
              id="email"
              formControlName="email"
              class="form-control"
              [readonly]="mode === 'view'"
              [class.error]="
                patientForm.get('email')?.invalid &&
                patientForm.get('email')?.touched
              "
            />
            <div
              *ngIf="
                patientForm.get('email')?.invalid &&
                patientForm.get('email')?.touched
              "
              class="error-message"
            >
              <span *ngIf="patientForm.get('email')?.errors?.['required']"
                >Email is required</span
              >
              <span *ngIf="patientForm.get('email')?.errors?.['email']"
                >Please enter a valid email</span
              >
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="address">Address</label>
          <textarea
            id="address"
            formControlName="address"
            class="form-control"
            rows="3"
            [readonly]="mode === 'view'"
          ></textarea>
        </div>
      </div>

      <div class="form-section">
        <h3>Medical Information</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="lastVisit">Last Visit</label>
            <input
              type="date"
              id="lastVisit"
              formControlName="lastVisit"
              class="form-control"
              [readonly]="mode === 'view'"
            />
          </div>

          <div class="form-group">
            <label for="status">Status *</label>
            <select
              id="status"
              formControlName="status"
              class="form-control"
              [class.error]="
                patientForm.get('status')?.invalid &&
                patientForm.get('status')?.touched
              "
            >
              <option value="Active">Active</option>
              <option value="Inactive">Inactive</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="medicalHistory">Medical History</label>
          <textarea
            id="medicalHistory"
            formControlName="medicalHistory"
            class="form-control"
            rows="4"
            [readonly]="mode === 'view'"
            placeholder="Enter patient's medical history, allergies, medications, etc."
          ></textarea>
        </div>
      </div>

      <div *ngIf="mode !== 'view'" class="form-actions">
        <button
          type="submit"
          class="btn-primary"
          [disabled]="patientForm.invalid"
        >
          {{ isEditing ? "Update Patient" : "Create Patient" }}
        </button>
        <button type="button" (click)="resetForm()" class="btn-secondary">
          Reset
        </button>
      </div>
    </form>

    <div *ngIf="mode === 'view'" class="view-actions">
      <button (click)="switchToEdit()" class="btn-primary">Edit Patient</button>
      <button (click)="deleteCurrentPatient()" class="btn-danger">
        Delete Patient
      </button>
      <button (click)="printDetails()" class="btn-secondary">Print</button>
    </div>
  </div>
</div>
