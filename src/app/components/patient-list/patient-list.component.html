<div class="patient-list-container">
  <div class="header">
    <h1>Patient List</h1>
    <button (click)="addNewPatient()" class="btn-primary">
      âž• Add New Patient
    </button>
  </div>

  <div class="search-filter">
    <input
      type="text"
      [(ngModel)]="searchTerm"
      (input)="filterPatients()"
      placeholder="Search patients..."
      class="search-input"
    />
    <select
      [(ngModel)]="statusFilter"
      (change)="filterPatients()"
      class="filter-select"
    >
      <option value="">All Status</option>
      <option value="Active">Active</option>
      <option value="Inactive">Inactive</option>
    </select>
  </div>

  <div class="patients-table">
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Date of Birth</th>
          <th>Gender</th>
          <th>Phone</th>
          <th>Email</th>
          <th>Last Visit</th>
          <th>Status</th>
          <th>Photo</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let patient of filteredPatients">
          <td>{{ patient.firstName }} {{ patient.lastName }}</td>
          <td>{{ patient.dateOfBirth | date }}</td>
          <td>{{ patient.gender }}</td>
          <td>{{ patient.phone }}</td>
          <td>{{ patient.email }}</td>
          <td>{{ patient.lastVisit | date }}</td>
          <td>
            <span class="status-badge" [class]="patient.status.toLowerCase()">
              {{ patient.status }}
            </span>
          </td>
          <td>
            <div class="patient-photo">
              <img
                [src]="patient.imageResult"
                [alt]="patient.firstName + ' ' + patient.lastName"
                (click)="
                  openImageModal(
                    patient.imageResult,
                    patient.firstName + ' ' + patient.lastName
                  )
                "
                (error)="onImageError($event)"
                class="profile-thumbnail"
              />
            </div>
          </td>
          <td class="actions">
            <div class="button-actions">
              <button (click)="viewPatient(patient.id)" class="btn-exam">
                Exam
              </button>
              <button (click)="editPatient(patient.id)" class="btn-edit">
                Edit
              </button>
              <button (click)="deletePatient(patient.id)" class="btn-delete">
                Delete
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="filteredPatients.length === 0" class="no-patients">
      No patients found matching your criteria.
    </div>
  </div>
</div>

@if (showImageModal) {
<div class="image-modal" (click)="closeImageModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ modalImageTitle }}</h3>
      <button class="close-btn" (click)="closeImageModal()">&times;</button>
    </div>
    <div class="modal-body">
      <img [src]="modalImageSrc" [alt]="modalImageTitle" class="modal-image" />
    </div>
    <div class="modal-footer">
      <button (click)="closeImageModal()" class="btn-secondary">Close</button>
    </div>
  </div>
</div>
}
